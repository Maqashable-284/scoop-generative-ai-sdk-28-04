# ğŸ¤– Scoop GenAI - áƒ¡áƒáƒáƒ áƒ¢áƒ£áƒšáƒ˜ áƒ™áƒ•áƒ”áƒ‘áƒ˜áƒ¡ AI áƒ™áƒáƒœáƒ¡áƒ£áƒšáƒ¢áƒáƒœáƒ¢áƒ˜

[![Security Grade](https://img.shields.io/badge/Security-B+-green)](CODE_REVIEW_REPORT.md)
[![Python](https://img.shields.io/badge/Python-3.11+-blue)](https://python.org)
[![License](https://img.shields.io/badge/License-MIT-yellow)](LICENSE)

## áƒ áƒ áƒáƒ áƒ˜áƒ¡ áƒ”áƒ¡ áƒáƒ áƒáƒ”áƒ¥áƒ¢áƒ˜?

áƒ”áƒ¡ áƒáƒ áƒ˜áƒ¡ **áƒ­áƒ™áƒ•áƒ˜áƒáƒœáƒ˜ áƒ©áƒáƒ¢áƒ‘áƒáƒ¢áƒ˜** áƒ áƒáƒ›áƒ”áƒšáƒ˜áƒª áƒ”áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ áƒáƒ“áƒáƒ›áƒ˜áƒáƒœáƒ”áƒ‘áƒ¡ áƒ¡áƒáƒáƒ áƒ¢áƒ£áƒšáƒ˜ áƒ™áƒ•áƒ”áƒ‘áƒ˜áƒ¡ áƒáƒ áƒáƒ“áƒ£áƒ¥áƒ¢áƒ”áƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒ áƒ©áƒ”áƒ•áƒáƒ¨áƒ˜. 

áƒ¬áƒáƒ áƒ›áƒáƒ˜áƒ“áƒ’áƒ˜áƒœáƒ” áƒ áƒáƒ› áƒ›áƒáƒ¦áƒáƒ–áƒ˜áƒáƒ¨áƒ˜ áƒ›áƒ˜áƒ®áƒ•áƒáƒš áƒ“áƒ áƒ’áƒ§áƒáƒ•áƒ¡ **áƒáƒ˜áƒ áƒáƒ“áƒ˜ áƒ™áƒáƒœáƒ¡áƒ£áƒšáƒ¢áƒáƒœáƒ¢áƒ˜** áƒ áƒáƒ›áƒ”áƒšáƒ˜áƒª:
- áƒ’áƒáƒ®áƒ¡áƒáƒ•áƒ¡ áƒ¨áƒ”áƒœáƒ˜ áƒ¡áƒáƒ®áƒ”áƒšáƒ˜ áƒ“áƒ áƒáƒšáƒ”áƒ áƒ’áƒ˜áƒ”áƒ‘áƒ˜
- áƒ˜áƒªáƒ˜áƒ¡ áƒ§áƒ•áƒ”áƒšáƒ áƒáƒ áƒáƒ“áƒ£áƒ¥áƒ¢áƒ˜áƒ¡ áƒ¤áƒáƒ¡áƒ˜ áƒ“áƒ áƒáƒ¦áƒ¬áƒ”áƒ áƒ
- áƒ’áƒ˜áƒ áƒ©áƒ”áƒ•áƒ¡ áƒ áƒ áƒ’áƒ­áƒ˜áƒ áƒ“áƒ”áƒ‘áƒ áƒ¨áƒ”áƒœáƒ˜ áƒ›áƒ˜áƒ–áƒœáƒ˜áƒ¡ áƒ›áƒ˜áƒ®áƒ”áƒ“áƒ•áƒ˜áƒ—

---

## ğŸ§  áƒ áƒáƒ’áƒáƒ  áƒ›áƒ£áƒ¨áƒáƒáƒ‘áƒ¡?

```
áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ˜: "áƒ’áƒáƒ›áƒáƒ áƒ¯áƒáƒ‘áƒ, áƒ›áƒ” áƒšáƒ£áƒ™áƒ áƒ›áƒ¥áƒ•áƒ˜áƒ, áƒšáƒáƒ¥áƒ¢áƒáƒ–áƒ˜áƒ¡ áƒáƒ£áƒ¢áƒáƒœáƒšáƒáƒ‘áƒ áƒ›áƒáƒ¥áƒ•áƒ¡"
     â†“
   [áƒ©áƒáƒ¢áƒ‘áƒáƒ¢áƒ˜ áƒ˜áƒœáƒáƒ®áƒáƒ•áƒ¡ áƒáƒ›áƒáƒ¡ áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ—áƒ áƒ‘áƒáƒ–áƒáƒ¨áƒ˜]
     â†“
áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ˜: "áƒ›áƒ˜áƒ áƒ©áƒ˜áƒ” áƒáƒ áƒáƒ¢áƒ”áƒ˜áƒœáƒ˜"
     â†“
   [áƒ©áƒáƒ¢áƒ‘áƒáƒ¢áƒ¡ áƒáƒ®áƒ¡áƒáƒ•áƒ¡ áƒ áƒáƒ› áƒšáƒáƒ¥áƒ¢áƒáƒ–áƒ áƒáƒ  áƒ¨áƒ”áƒ˜áƒ«áƒšáƒ”áƒ‘áƒ]
     â†“
áƒ©áƒáƒ¢áƒ‘áƒáƒ¢áƒ˜: "áƒ’áƒ˜áƒ áƒ©áƒ”áƒ• áƒ›áƒªáƒ”áƒœáƒáƒ áƒ”áƒ£áƒš áƒáƒ áƒáƒ¢áƒ”áƒ˜áƒœáƒ¡ - Applied Nutrition Critical Plant..."
```

---

## ğŸ“ áƒáƒ áƒáƒ”áƒ¥áƒ¢áƒ˜áƒ¡ áƒ¡áƒ¢áƒ áƒ£áƒ¥áƒ¢áƒ£áƒ áƒ

```
scoop-genai-project/
â”‚
â”œâ”€â”€ main.py                    â† áƒ›áƒ—áƒáƒ•áƒáƒ áƒ˜ áƒ¤áƒáƒ˜áƒšáƒ˜ (áƒ¡áƒ”áƒ áƒ•áƒ”áƒ áƒ˜)
â”œâ”€â”€ config.py                  â† áƒáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ”áƒ‘áƒ˜ + System Prompt
â”œâ”€â”€ requirements.txt           â† áƒ¡áƒáƒ­áƒ˜áƒ áƒ áƒ‘áƒ˜áƒ‘áƒšáƒ˜áƒáƒ—áƒ”áƒ™áƒ”áƒ‘áƒ˜
â”œâ”€â”€ .env                       â† API keys (áƒ¡áƒáƒ˜áƒ“áƒ£áƒ›áƒšáƒ!)
â”‚
â”œâ”€â”€ prompts/
â”‚   â””â”€â”€ system_prompt.py       â† AI-áƒ˜áƒ¡ áƒ˜áƒœáƒ¡áƒ¢áƒ áƒ£áƒ¥áƒªáƒ˜áƒ”áƒ‘áƒ˜
â”‚
â””â”€â”€ app/
    â”œâ”€â”€ memory/
    â”‚   â””â”€â”€ mongo_store.py     â† áƒ›áƒáƒ®áƒ¡áƒáƒ•áƒ áƒáƒ‘áƒ (MongoDB-áƒ¨áƒ˜ áƒ˜áƒœáƒáƒ®áƒáƒ•áƒ¡)
    â”‚
    â”œâ”€â”€ catalog/
    â”‚   â””â”€â”€ loader.py          â† áƒáƒ áƒáƒ“áƒ£áƒ¥áƒ¢áƒ”áƒ‘áƒ˜áƒ¡ áƒ©áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ
    â”‚
    â””â”€â”€ tools/
        â””â”€â”€ user_tools.py      â† Gemini Function Calling Tools
```

---

## ğŸ”§ áƒ¢áƒ”áƒ¥áƒœáƒáƒšáƒáƒ’áƒ˜áƒ”áƒ‘áƒ˜

| áƒ¢áƒ”áƒ¥áƒœáƒáƒšáƒáƒ’áƒ˜áƒ | áƒ•áƒ”áƒ áƒ¡áƒ˜áƒ | áƒ áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡ áƒ’áƒáƒ›áƒáƒ˜áƒ§áƒ”áƒœáƒ”áƒ‘áƒ |
|------------|--------|---------------------|
| **Google Gemini 2.5 Flash** | Latest | áƒ®áƒ”áƒšáƒáƒ•áƒœáƒ£áƒ áƒ˜ áƒ˜áƒœáƒ¢áƒ”áƒšáƒ”áƒ¥áƒ¢áƒ˜ |
| **FastAPI** | 0.115+ | Python áƒ•áƒ”áƒ‘-áƒ¡áƒ”áƒ áƒ•áƒ”áƒ áƒ˜ |
| **MongoDB** | 7.0+ | áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ—áƒ áƒ‘áƒáƒ–áƒ |
| **Motor** | 3.6+ | Async MongoDB driver |
| **PyMongo** | 4.10+ | Sync MongoDB (Tools) |
| **slowapi** | 0.1.9 | Rate Limiting |

---

## ğŸš€ Quick Start

### 1. áƒ“áƒáƒáƒ˜áƒœáƒ¡áƒ¢áƒáƒšáƒ˜áƒ áƒ” áƒ‘áƒ˜áƒ‘áƒšáƒ˜áƒáƒ—áƒ”áƒ™áƒ”áƒ‘áƒ˜:
```bash
pip install -r requirements.txt
```

### 2. áƒ¨áƒ”áƒ¥áƒ›áƒ”áƒœáƒ˜ `.env` áƒ¤áƒáƒ˜áƒšáƒ˜:
```env
# Required
GEMINI_API_KEY=your_gemini_api_key
MONGODB_URI=mongodb+srv://...
MONGODB_DATABASE=scoop_db

# Security (Production)
ADMIN_TOKEN=your_secure_admin_token
ALLOWED_ORIGINS=https://yourdomain.com
DEBUG=false
```

### 3. áƒ’áƒáƒ£áƒ¨áƒ•áƒ˜ áƒ¡áƒ”áƒ áƒ•áƒ”áƒ áƒ˜:
```bash
python3 main.py
```

### 4. áƒ¨áƒ”áƒ“áƒ”áƒ’áƒ˜:
```
INFO: Uvicorn running on http://0.0.0.0:8080
```

---

## ğŸ“¡ API Endpoints

| Endpoint | Method | Description | Auth |
|----------|--------|-------------|------|
| `/` | GET | áƒ¡áƒ”áƒ áƒ•áƒ”áƒ áƒ˜áƒ¡ áƒ¡áƒ¢áƒáƒ¢áƒ£áƒ¡áƒ˜ | âŒ |
| `/health` | GET | áƒ¯áƒáƒœáƒ›áƒ áƒ—áƒ”áƒšáƒáƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ | âŒ |
| `/chat` | POST | áƒ›áƒ—áƒáƒ•áƒáƒ áƒ˜ áƒ©áƒáƒ¢áƒ˜ | âŒ |
| `/chat/stream` | POST | SSE Streaming | âŒ |
| `/sessions` | GET | áƒáƒ¥áƒ¢áƒ˜áƒ£áƒ áƒ˜ áƒ¡áƒ”áƒ¡áƒ˜áƒ”áƒ‘áƒ˜ | âœ… Admin |
| `/session/clear` | POST | áƒ¡áƒ”áƒ¡áƒ˜áƒ˜áƒ¡ áƒ¬áƒáƒ¨áƒšáƒ | âœ… Admin |

### áƒ›áƒáƒ’áƒáƒšáƒ˜áƒ—áƒ˜ - Chat:
```bash
curl -X POST http://localhost:8080/chat \
  -H "Content-Type: application/json" \
  -d '{"user_id": "user123", "message": "áƒ›áƒ˜áƒœáƒ“áƒ áƒáƒ áƒáƒ¢áƒ”áƒ˜áƒœáƒ˜"}'
```

### áƒ›áƒáƒ’áƒáƒšáƒ˜áƒ—áƒ˜ - Admin Endpoint:
```bash
curl -X GET http://localhost:8080/sessions \
  -H "X-Admin-Token: your_admin_token"
```

---

## ğŸ” Security Features

### Implemented (v1.1.0)

| Feature | Description |
|---------|-------------|
| **Rate Limiting** | 30 requests/minute per IP (slowapi) |
| **Input Validation** | Pydantic validators (user_id, message length) |
| **Admin Authentication** | X-Admin-Token header required |
| **Regex Injection Protection** | `re.escape()` on user input |
| **Error Message Sanitization** | Error IDs instead of stack traces |
| **CORS Warning** | Logs warning if `*` used in production |

### Environment Variables

| Variable | Required | Default | Description |
|----------|----------|---------|-------------|
| `GEMINI_API_KEY` | âœ… | - | Google Gemini API Key |
| `MONGODB_URI` | âœ… | - | MongoDB Connection String |
| `MONGODB_DATABASE` | âŒ | scoop_db | Database Name |
| `ADMIN_TOKEN` | âŒ | - | Admin endpoint auth |
| `ALLOWED_ORIGINS` | âŒ | `*` | CORS origins (comma-separated) |
| `DEBUG` | âŒ | false | Debug mode |

---

## ğŸ§  áƒ›áƒáƒ®áƒ¡áƒáƒ•áƒ áƒáƒ‘áƒ (Memory)

áƒ©áƒáƒ¢áƒ‘áƒáƒ¢áƒ¡ **áƒáƒ®áƒ¡áƒáƒ•áƒ¡** áƒ§áƒ•áƒ”áƒšáƒáƒ¤áƒ”áƒ áƒ˜:

| áƒ áƒ áƒáƒ®áƒ¡áƒáƒ•áƒ¡ | áƒ›áƒáƒ’áƒáƒšáƒ˜áƒ—áƒ˜ |
|-----------|---------| 
| áƒ¡áƒáƒ®áƒ”áƒšáƒ˜ | "áƒ›áƒ” áƒšáƒ£áƒ™áƒ áƒ›áƒ¥áƒ•áƒ˜áƒ" |
| áƒáƒšáƒ”áƒ áƒ’áƒ˜áƒ”áƒ‘áƒ˜ | "áƒšáƒáƒ¥áƒ¢áƒáƒ–áƒ˜áƒ¡ áƒáƒ£áƒ¢áƒáƒœáƒšáƒáƒ‘áƒ áƒ›áƒáƒ¥áƒ•áƒ¡" |
| áƒ›áƒ˜áƒ–áƒœáƒ”áƒ‘áƒ˜ | "áƒ™áƒ£áƒœáƒ—áƒ˜áƒ¡ áƒ›áƒáƒ¡áƒ áƒ›áƒ˜áƒœáƒ“áƒ" |
| áƒ¬áƒ˜áƒœáƒ áƒ™áƒ˜áƒ—áƒ®áƒ•áƒ”áƒ‘áƒ˜ | "áƒ áƒ áƒ’áƒ™áƒ˜áƒ—áƒ®áƒ”?" â†’ áƒáƒ®áƒ¡áƒáƒ•áƒ¡! |

### áƒ áƒáƒ’áƒáƒ  áƒ›áƒ£áƒ¨áƒáƒáƒ‘áƒ¡:
1. áƒ§áƒáƒ•áƒ”áƒšáƒ˜ áƒ›áƒ”áƒ¡áƒ˜áƒ¯áƒ˜ áƒ˜áƒœáƒáƒ®áƒ”áƒ‘áƒ **MongoDB**-áƒ¨áƒ˜
2. áƒ áƒáƒªáƒ áƒ®áƒ”áƒšáƒáƒ®áƒšáƒ áƒ¬áƒ”áƒ , áƒ©áƒáƒ¢áƒ‘áƒáƒ¢áƒ˜ áƒ©áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒáƒ•áƒ¡ áƒ˜áƒ¡áƒ¢áƒáƒ áƒ˜áƒáƒ¡
3. **7 áƒ“áƒ¦áƒ˜áƒ¡** áƒ¨áƒ”áƒ›áƒ“áƒ”áƒ’ áƒáƒ•áƒ¢áƒáƒ›áƒáƒ¢áƒ£áƒ áƒáƒ“ áƒ˜áƒ¨áƒšáƒ”áƒ‘áƒ (TTL Index)

---

## ğŸ› ï¸ Gemini Function Calling

áƒ©áƒáƒ¢áƒ‘áƒáƒ¢áƒ˜ áƒ˜áƒ§áƒ”áƒœáƒ”áƒ‘áƒ¡ **Automatic Function Calling**-áƒ¡:

| Tool | Description |
|------|-------------|
| `get_user_profile` | áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ˜áƒ¡ áƒáƒ áƒáƒ¤áƒ˜áƒšáƒ˜áƒ¡ áƒ¬áƒáƒ™áƒ˜áƒ—áƒ®áƒ•áƒ |
| `update_user_profile` | áƒáƒ áƒáƒ¤áƒ˜áƒšáƒ˜áƒ¡ áƒ’áƒáƒœáƒáƒ®áƒšáƒ”áƒ‘áƒ |
| `search_products` | áƒáƒ áƒáƒ“áƒ£áƒ¥áƒ¢áƒ”áƒ‘áƒ˜áƒ¡ áƒ«áƒ”áƒ‘áƒœáƒ |
| `get_product_details` | áƒ“áƒ”áƒ¢áƒáƒšáƒ£áƒ áƒ˜ áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒ |

---

## ğŸ’° Cost Comparison

| | Claude SDK (áƒ«áƒ•áƒ”áƒšáƒ˜) | Gemini 2.5 Flash |
|--|-------------------|------------------|
| áƒ—áƒ•áƒ”áƒ¨áƒ˜ | ~$1,500 | ~$15 |
| áƒ“áƒáƒœáƒáƒ–áƒáƒ’áƒ˜ | - | **99%** |

---

## ğŸ“Š Recent Updates

### v1.2.1 (2026-01-13) ğŸ› Critical Bug Fix
- ğŸ”’ **CRITICAL**: Fixed user_id hallucination bug in `get_user_profile()`
  - **Problem**: AI was hallucinating wrong user_ids (e.g., "user_123") when calling tools
  - **Impact**: Users received OTHER users' profile data (GDPR violation!)
  - **Solution**: Implemented `ContextVar` for async-safe user_id context
  - **Result**: Each request has isolated context - impossible to access wrong user's data
- ğŸ”§ **Data Deletion Fix**: Page reload after deletion to ensure clean frontend state
- âœ… **Verified**: 7-day TTL, session cleanup, and user isolation all working correctly

### v1.2.0 (2026-01-13)
- ğŸ›¡ï¸ **Gemini 3 Fix**: Defensive check for empty `query` in `search_products` (sporadic bug)
- ğŸ”’ **Privacy Controls**: GDPR data deletion endpoint `/user/{user_id}/data`
- ğŸ“œ **History Retrieval**: Multi-session support, sidebar with conversation list
- âœ… **Consent Modal**: User opt-in for data storage

### v1.1.0 (2026-01-13)
- ğŸ” **Security Fixes**: 6 P0 vulnerabilities fixed
- ğŸ”§ **Bug Fixes**: Async loop conflict, RepeatedComposite serialization
- âš¡ **Rate Limiting**: slowapi integration
- âœ… **Input Validation**: Pydantic validators

### v1.0.0 (2026-01-12)
- ğŸš€ Initial release
- ğŸ§  Gemini 2.5 Flash integration
- ğŸ’¾ MongoDB persistence
- ğŸ”„ Session management

---

## ğŸ“ Documentation

- [CODE_REVIEW_REPORT.md](CODE_REVIEW_REPORT.md) - Security Audit Results
- [docs/RESPONSE_STYLE_GUIDE.md](docs/RESPONSE_STYLE_GUIDE.md) - AI Response Guidelines

---

## ğŸ‘¥ Authors

áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ˜áƒšáƒ˜áƒ **Scoop.ge**-áƒ¡áƒ—áƒ•áƒ˜áƒ¡

**Repository**: https://github.com/Maqashable-284/scoop-genai-project